@model Etammen.ViewModels.JSONMainViewModelHolder
@using System.Text.Json;

@{
    var myModel = JsonSerializer.Deserialize<MainViewModel>(Model.JSONdata);
    SelectList Cities = new SelectList(myModel.city_areaDict.Keys);
    SelectList specialitiesSL = new SelectList(myModel.Specialties);
    var dict = @myModel.city_areaDict;
}

<form id="form" asp-action="Index" onsubmit="updateAndSubmit(event)">
    <input type="hidden" name="JSONdata" />
    <select asp-items="specialitiesSL" class="form-select" name="specialty"></select>
    <label>City</label>
    <select asp-items="Cities" id="cityselectlist" class="form-select" name="city"></select>
    <label>Area</label>
    <select id="areaselectlist" class="form-select" name="area">
        <option value="ALL">ALL</option>
    </select>
    <label>Doctor Name</label>
    <br />
    <input type="text" value="" placeholder="EX: Ahmed Mostafa" name="doctorName" class="form-text" />
    <br />
    <label>Clinic Name</label>
    <br />
    <input type="text" value="" placeholder="EX: ElAml" name="clinicName" class="form-text" />
    <br />
    <input id="submit" type="submit" value="submit" class="btn btn-primary" />
</form>

@section Scripts {
    <script>
        let City_Area = {};
        let myModel = @Html.Raw(Json.Serialize(myModel));
        @foreach (var pair in myModel.city_areaDict)
        {
            <text>
                City_Area["@pair.Key"]=[];
            </text>
            @foreach (var area in pair.Value)
            {
                <text>
                    City_Area["@pair.Key"].push("@area");
                </text>
            }
        }

            function updateAndSubmit(event) {
                let specialty = document.querySelector("[name=specialty]").value;
                let city = document.querySelector("[name=city]").value;
                let area = document.querySelector("[name=area]").value;
                let doctorName = document.querySelector("[name=doctorName]").value;
                let clinicName = document.querySelector("[name=clinicName]").value;

                console.log("Specialty:", specialty);
                console.log("City:", city);
                console.log("Area:", area);
                console.log("Doctor Name:", doctorName);
                console.log("Clinic Name:", clinicName);

                // Update myModel properties here
                myModel.specialty = specialty;
                myModel.city = city;
                myModel.area = area;
                myModel.doctorName = doctorName;
                myModel.clinicName = clinicName;

                // Serialize updated myModel to JSON
                let json = JSON.stringify(myModel);

                console.log("JSON:", json);

                // Update hidden input field value
                document.querySelector("[name=JSONdata]").value = json;

                // Submit the form
                document.querySelector("form").submit();
            }

        document.getElementById("cityselectlist").addEventListener("change", function () {
            let areaSelect = document.getElementById("areaselectlist");
            areaSelect.innerHTML = '';
            let selectedIndex = this.selectedIndex;
            let selectedValue = this.options[selectedIndex].value;
            let areas = City_Area[selectedValue];
            for (let area of areas) {
                let newOption = document.createElement("option");
                newOption.value = area;
                newOption.text = area;
                areaSelect.appendChild(newOption);
            }
        });
    </script>
}